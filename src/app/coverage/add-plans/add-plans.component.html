<section class="bp-mainpolicy">
  <article class="row">
    <div class="col-md-12">
      <form class="was-validated' : formInvalid" [formGroup]="formAddPlans" novalidate>
        <div class="col-md-12">
          <div class="bp-itemtitle mt-4">
            <h2 class="bp-titlepolicy">
              {{ 'COVERAGES.ADD_PLANS.TITLE_01' | translate }}
            </h2>
          </div>
          <p class="mt-2">
            {{ 'COVERAGES.ADD_PLANS.TITLE_02' | translate }}
          </p>
        </div>

        <div class="col-md-12 my-4" formGroupName="filterCriteria">
          <div class="row align-items-end">

            <div class="col-md">
              <div class="form-group">
                <label>{{ 'COVERAGES.ADD_PLANS.BUSSINESS_CTRL_LBL' | translate }}</label>
                <ng-select #selectBussinessId [items]="bussinessResponse" [selectOnTab]="true" bindValue="id"
                  bindLabel="name" formControlName="bussinessId" class="form-control">
                </ng-select>
              </div>
            </div>

            <div class="col-md">
              <div class="form-group">
                <label>{{ 'COVERAGES.ADD_PLANS.PRODUCT_CTRL_LBL' | translate }}</label>
                <ng-select #selectProductKey [items]="productsResponse" [selectOnTab]="true" bindValue="productKey"
                  bindLabel="name" formControlName="productKey" class="form-control">
                </ng-select>
              </div>
            </div>
            <div class="col-md">
              <div class="form-group">
                <label> {{ 'COVERAGES.ADD_PLANS.PLAN_CTRL_LBL' | translate }}</label>
                <ng-select #selectPlanKey [items]="plansResponse" [selectOnTab]="true" bindValue="planKey"
                  bindLabel="planName" formControlName="planKey" class="form-control">
                </ng-select>
              </div>
            </div>

            <div class="col-md-1">
              <button class="bp-btn bp-btnprimary" [ngClass]="{disabled: filterCriteriaInvalid()}"
                (click)="generateCoverageRequest(INIT_PAGE, false)">
                <i class="material-icons">search</i>
              </button>
            </div>

            <div class="col-md-1">
              <button class="bp-btn bp-btnsecondary" [ngClass]="{disabled: filterCriteriaEmpty()}"
                (click)="cleanFilterValuesAndSearch(false)">
                <i class="material-icons">delete</i>
              </button>
            </div>

          </div>
          <div class="row" *ngIf="sucessSearch">
            <div class="col-md-4 mt-4">
              <div class="form-group">
                <label for="generalWaitingPeriodDays">
                  {{ 'COVERAGES.ADD_PLANS.GENERAL_WAITING_PERIOD' | translate }}</label>
                <input class="form-control ng-pristine ng-valid ng-touched" id="generalWaitingPeriodDays"
                  formControlName="generalWaitingPeriodDays" type="number" maxlength="50">
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-12" *ngIf="sucessSearch">

          <div class="row align-items-end">

            <div class="col-md-10">
              <h6 style="font-weight: 700;">
                {{ 'COVERAGES.ADD_PLANS.TITLE_01' | translate }}
              </h6>
              <hr>
            </div>

            <div class="col-md-2">
              <div class="row align-items-center">
                <div class="col-md-10 offset-2">
                  <button class="bp-btn bp-btnprimary" type="button" data-toggle="modal"
                    data-target=".bd-example-modal-lg" (click)="openModalExcludedCoverages()">
                    <i class="material-icons">add_circle</i>
                    {{ 'COVERAGES.ADD_PLANS.COVERAGE_BTN' | translate }}
                  </button>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <p> {{ 'COVERAGES.ADD_PLANS.CLOSED_COVERAGE_MSG' | translate }} </p>
            </div>
            <div class="col-md-12">
              <p>{{ 'COVERAGES.ADD_PLANS.ASSOCIATE_COVERAGES' | translate }}{{coverageResponse.count}}</p>
            </div>
          </div>
          <div class="bp-netprov" *ngIf="coverageResponse.data.length > 0">
            <div class="row align-items-center">
              <div class="col-md-12 mt-2" formArrayName="coverageList">
                <table class="table">

                  <thead class="thead-light">
                    <tr>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COVERAGE_REFERENCE' | translate }} <app-custom-popover
                        [title]="" [content]="[]" [template]="['COVERAGES.ADD_PLANS.COVERAGE_REFERENCE'|translate]">
                      </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COVERAGE_NAME_LITTLE' | translate }} <app-custom-popover
                          [title]="" [content]="[]" [template]="['COVERAGES.ADD_PLANS.COVERAGE_NAME'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.REQUIRED_PREAUTHORIZATION_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.REQUIRED_PREAUTHORIZATION'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.DEDUCTIBLE_LITTLE' | translate }} <app-custom-popover
                          [title]="" [content]="[]" [template]="['COVERAGES.ADD_PLANS.DEDUCTIBLE'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COVERAGE_FROM_DATE_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.COVERAGE_FROM_DATE'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COVERAGE_TO_DATE_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.COVERAGE_TO_DATE'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COINSURANCE_LITTLE' | translate }} <app-custom-popover
                          [title]="" [content]="[]" [template]="['COVERAGES.ADD_PLANS.COINSURANCE'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COPAY_LITTLE' | translate }} <app-custom-popover
                          [title]="" [content]="[]" [template]="['COVERAGES.ADD_PLANS.COPAY'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COST_LIMIT_TOTAL_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.COST_LIMIT_TOTAL'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.QUANTITY_LIMIT_LITTLE' | translate }} <app-custom-popover
                          [title]="" [content]="[]" [template]="['COVERAGES.ADD_PLANS.QUANTITY_LIMIT'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.COST_LIMIT_UNIT_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.COST_LIMIT_UNIT'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.WAITING_PERIOD_DAYS_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.WAITING_PERIOD_DAYS'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col"> {{ 'COVERAGES.ADD_PLANS.WAITING_PERIOD_MONTHS_LITTLE' | translate }}
                        <app-custom-popover [title]="" [content]="[]"
                          [template]="['COVERAGES.ADD_PLANS.WAITING_PERIOD_MONTHS'|translate]">
                        </app-custom-popover>
                      </th>
                      <th scope="col" *ngIf="false">Accion</th>
                    </tr>
                  </thead>

                  <tbody *ngFor="let item of coverageResponse.data ; let i = index;">
                    <tr [formGroupName]="i">
                      <th scope="row">
                        {{item.coverages.coverageId}}
                      </th>

                      <th scope="row">
                        {{item.coverages.coverageName}}
                      </th>

                      <td class="form-group">
                        <div [ngClass]="{ 
                          'border-danger': getNestedControl(i, 'requiresPreautorization').invalid && formInvalid }"
                          style="padding:10px 0;">
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="CHECK_YES" value="true"
                              formControlName="requiresPreautorization">
                            <label class="form-check-label"
                              for="CHECK_YES">{{'POLICY.POLICY_ENROLLMENT.STEP8.CHECK_YES' | translate }}</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="CHECK_NO" value="false"
                              formControlName="requiresPreautorization">
                            <label class="form-check-label"
                              for="CHECK_NO">{{'POLICY.POLICY_ENROLLMENT.STEP8.CHECK_NO' | translate }}</label>
                          </div>
                        </div>
                      </td>

                      <td class="form-group">
                        <div [ngClass]="{ 
                          'border-danger': getNestedControl(i, 'deductible').invalid && formInvalid }"
                          style="padding:10px 0;">
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="CHECK_YES_DEDUCTIBLE" value="true"
                              formControlName="deductible">
                            <label class="form-check-label"
                              for="CHECK_YES_DEDUCTIBLE">{{'POLICY.POLICY_ENROLLMENT.STEP8.CHECK_YES' | translate }}</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="CHECK_NO_DEDUCTIBLE" value="false"
                              formControlName="deductible">
                            <label class="form-check-label"
                              for="CHECK_NO_DEDUCTIBLE">{{'POLICY.POLICY_ENROLLMENT.STEP8.CHECK_NO' | translate }}</label>
                          </div>
                        </div>
                      </td>

                      <td class="form-group">
                        <app-datepicker-wrapper formControlName="fromDate"
                          [dateValue]="getNestedControl(i, FROM_DATE_CTRL).value"
                          [hasErrors]="getNestedControl(i, FROM_DATE_CTRL).errors ? true: false"
                          [showValidations]="formInvalid">
                        </app-datepicker-wrapper>
                      </td>

                      <td class="form-group">
                        <app-datepicker-wrapper formControlName="toDate"
                          [dateValue]="getNestedControl(i, TO_DATE_CTRL).value"
                          [hasErrors]="getNestedControl(i, TO_DATE_CTRL).errors ? true: false"
                          [showValidations]="formInvalid">
                        </app-datepicker-wrapper>
                      </td>

                      <td class="form-group">
                        <div class="form-check form-check-inline">
                          <input type="text" class="form-control" formControlName="coinsurance" appOnlyNumber="true">
                          <label *ngIf="getNestedControl(i, 'coinsurance').value"> %</label>
                        </div>
                      </td>

                      <td class="form-group">
                        <div class="input-group">
                          <input class="form-control" formControlName="copay" type="text" appCurrencyFormatter="$"
                            appOnlyNumber="true">
                        </div>
                      </td>

                      <td class="form-group">
                        <div class="input-group">
                          <input class="form-control" formControlName="costLimitTotal" type="text"
                            appCurrencyFormatter="$" appOnlyNumber="true">
                        </div>
                      </td>

                      <td class="form-group">
                        <div class="form-check form-check-inline">
                          <input type="text" class="form-control" formControlName="quantityLimit" appOnlyNumber="true">
                        </div>
                      </td>

                      <td class="form-group">
                        <div class="input-group">
                          <input class="form-control" formControlName="costLimitUnit" type="text"
                            appCurrencyFormatter="$" appOnlyNumber="true">
                        </div>
                      </td>

                      <td class="form-group">
                        <div class="form-check form-check-inline">
                          <input type="text" class="form-control" formControlName="waitingPeriodDays"
                            appOnlyNumber="true">
                        </div>
                      </td>

                      <td class="form-group">
                        <div class="form-check form-check-inline">
                          <input type="text" class="form-control" formControlName="waitingPeriodMonths"
                            appOnlyNumber="true">
                        </div>
                      </td>
                      <td *ngIf="false">
                        <button class="ig-icondiagnosminim" style="cursor: pointer;" type="button">
                          <i class="material-icons">
                            delete_forever
                          </i>
                        </button>
                      </td>

                    </tr>
                  </tbody>

                </table>


              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12" *ngIf="formInvalid && formAddPlans.get(this.COVERAGE_LIST_FA).invalid">
              <div class="bp-alertform">
                <div class="alert alert-danger text-center">
                  <i class="material-icons">info</i>
                  {{ 'POLICY.POLICY_ENROLLMENT.STEP1.ALERT_COMPLETE_FORM' | translate }}
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <div *ngIf="collectionSize > PAGE_SIZE"
                style="justify-content: center;display: flex;width: 100%; margin-top:15px;">
                <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="PAGE_SIZE" [rotate]="true"
                  [boundaryLinks]="true" (pageChange)="generateCoverageRequest($event, true)">
                </ngb-pagination>
              </div>
            </div>
          </div>


          <div class="row" *ngIf="coverageResponse.data.length>0">
            <div class="col-md-2 offset-md-5">
              <button class="ig-botones ngclass ig-principalbtn" type="button" (click)="continue()">
                {{ 'COVERAGES.ADD_PLANS.SUBMIT_COVERAGES_BTN' | translate }}
              </button>
            </div>
          </div>


        </div>


        <div class="col-md-12" *ngIf="sucessSearch">
          <div class="row">
            <div class="col-md-12 ig-searchresul animated fadeIn" *ngIf="coverageResponse.data.length === 0">
              <h4>{{ 'APP.RESULTADO_BUSQUEDA' | translate }}</h4>
              <p>{{ 'CLAIMS.PRE_AUTHORIZATION.STEP_2.DIAGNOSTIC_NOT_FOUND' | translate }}</p>
            </div>
          </div>
        </div>
      </form>
    </div>
  </article>
</section>